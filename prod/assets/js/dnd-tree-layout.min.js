treeJSON=d3.json("/data/dnd-tree-layout.json",function(t,e){function n(t,e,r){if(t){e(t);var a=r(t);if(a)for(var l=a.length,i=0;i<l;i++)n(a[i],e,r)}}function r(){E.sort(function(t,e){return e.name.toLowerCase()<t.name.toLowerCase()?1:-1})}function a(t,e){var n=C;panTimer&&(clearTimeout(panTimer),translateCoords=d3.transform(S.attr("transform")),"left"==e||"right"==e?(translateX="left"==e?translateCoords.translate[0]+n:translateCoords.translate[0]-n,translateY=translateCoords.translate[1]):"up"!=e&&"down"!=e||(translateX=translateCoords.translate[0],translateY="up"==e?translateCoords.translate[1]+n:translateCoords.translate[1]-n),scaleX=translateCoords.scale[0],scaleY=translateCoords.scale[1],scale=X.scale(),S.transition().attr("transform","translate("+translateX+","+translateY+")scale("+scale+")"),d3.select(t).select("g.node").attr("transform","translate("+translateX+","+translateY+")"),X.scale(X.scale()),X.translate([translateX,translateY]),panTimer=setTimeout(function(){a(t,n,e)},50))}function l(){S.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}function i(t,e){m=t,d3.select(e).select(".ghostCircle").attr("pointer-events","none"),d3.selectAll(".ghostCircle").attr("class","ghostCircle show"),d3.select(e).attr("class","node activeDrag"),S.selectAll("g.node").sort(function(t,e){return t.id!=m.id?1:-1}),nodes.length>1&&(links=E.links(nodes),nodePaths=S.selectAll("path.link").data(links,function(t){return t.target.id}).remove(),nodesExit=S.selectAll("g.node").data(nodes,function(t){return t.id}).filter(function(t,e){return t.id!=m.id}).remove()),parentLink=E.links(E.nodes(m.parent)),S.selectAll("path.link").filter(function(t,e){return t.target.id==m.id}).remove(),dragStarted=null}function o(){v=null,d3.selectAll(".ghostCircle").attr("class","ghostCircle"),d3.select(domNode).attr("class","node"),d3.select(domNode).select(".ghostCircle").attr("pointer-events",""),z(),null!==m&&(h(f),d(m),m=null)}function s(t){t._children&&(t.children=t._children,t.children.forEach(s),t._children=null)}function d(t){scale=X.scale(),x=-t.y0,y=-t.x0,x=x*scale+A/2,y=y*scale+w/2,d3.select("g").transition().duration(T).attr("transform","translate("+x+","+y+")scale("+scale+")"),X.scale(scale),X.translate([x,y])}function c(t){return t.children?(t._children=t.children,t.children=null):t._children&&(t.children=t._children,t._children=null),t}function u(t){d3.event.defaultPrevented||(t=c(t),h(t),d(t))}function h(t){var e=[1],n={},r=function(t,n){n.children&&n.children.length>0&&(e.length<=t+1&&e.push(0),e[t+1]+=n.children.length,n.children.forEach(function(e){r(t+1,e)}))};r(0,f);var a=25*d3.max(e);E=E.size([a,A]);var l=E.nodes(f).reverse(),i=E.links(l);l.forEach(function(t){t.y=t.depth*(10*g),void 0===n[t.depth]?n[t.depth]=0:n[t.depth]++,t.vDepth=n[t.depth]}),node=S.selectAll("g.node").data(l,function(t){return t.id||(t.id=++k)});var o=node.enter().append("g").call(dragListener).attr("class","node").attr("transform",function(e){return"translate("+t.y0+","+t.x0+")"}).on("click",u);o.append("circle").attr("class","nodeCircle").attr("r",0).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),o.append("text").attr("x",function(t){return t.children||t._children?-10:10}).attr("dy",".35em").attr("class","nodeText").attr("text-anchor",function(t){return t.children||t._children?"end":"start"}).text(function(t){return t.name}).style("fill-opacity",0),o.append("circle").attr("class","ghostCircle").attr("r",30).attr("opacity",.2).style("fill","red").attr("pointer-events","mouseover").on("mouseover",function(t){L(t)}).on("mouseout",function(t){b(t)}),node.select("text").attr("x",function(t){return t.children||t._children?-10:10}).attr("text-anchor",function(t){return t.children||t._children?"end":"start"}).text(function(t){return t.name}),node.select("circle.nodeCircle").attr("r",4.5).style("fill",function(t){return t._children?"lightsteelblue":"#fff"});var s=node.transition().duration(T).attr("transform",function(t){return"translate("+t.y+","+100*t.vDepth+")"});s.select("text").style("fill-opacity",1);var d=node.exit().transition().duration(T).attr("transform",function(e){return"translate("+t.y+","+t.x+")"}).remove();d.select("circle").attr("r",0),d.select("text").style("fill-opacity",0);var c=S.selectAll("path.link").data(i,function(t){return t.target.id});c.enter().insert("path","g").attr("class","link").attr("d",function(e){var n={x:t.x0,y:t.y0};return N({source:n,target:n})}),c.transition().duration(T).attr("d",N),c.exit().transition().duration(T).attr("d",function(e){var n={x:t.x,y:t.y};return N({source:n,target:n})}).remove(),l.forEach(function(t){t.x0=t.x,t.y0=t.y})}var f,p=0,g=0,v=null,m=null,C=200,_=20,k=0,T=750,A=$(document).width(),w=$(document).height(),E=d3.layout.tree().size([w,A]),N=d3.svg.diagonal().projection(function(t){return[t.y,t.x]});n(e,function(t){p++,g=Math.max(t.name.length,g)},function(t){return t.children&&t.children.length>0?t.children:null}),r();var X=d3.behavior.zoom().scaleExtent([.1,3]).on("zoom",l),Y=d3.select("#tree-container").append("svg").attr("width",A).attr("height",w).attr("class","overlay").call(X);dragListener=d3.behavior.drag().on("dragstart",function(t){t!=f&&(dragStarted=!0,nodes=E.nodes(t),d3.event.sourceEvent.stopPropagation())}).on("drag",function(t){if(t!=f){if(dragStarted&&(domNode=this,i(t,domNode)),relCoords=d3.mouse($("svg").get(0)),relCoords[0]<_)panTimer=!0,a(this,"left");else if(relCoords[0]>$("svg").width()-_)panTimer=!0,a(this,"right");else if(relCoords[1]<_)panTimer=!0,a(this,"up");else if(relCoords[1]>$("svg").height()-_)panTimer=!0,a(this,"down");else try{clearTimeout(panTimer)}catch(t){}t.x0+=d3.event.dy,t.y0+=d3.event.dx;var e=d3.select(this);e.attr("transform","translate("+t.y0+","+t.x0+")"),z()}}).on("dragend",function(t){if(t!=f)if(domNode=this,v){var e=m.parent.children.indexOf(m);e>-1&&m.parent.children.splice(e,1),"undefined"!=typeof v.children||"undefined"!=typeof v._children?"undefined"!=typeof v.children?v.children.push(m):v._children.push(m):(v.children=[],v.children.push(m)),s(v),r(),o()}else o()});var L=function(t){v=t,z()},b=function(t){v=null,z()},z=function(){var t=[];null!==m&&null!==v&&(t=[{source:{x:v.y0,y:v.x0},target:{x:m.y0,y:m.x0}}]);var e=S.selectAll(".templink").data(t);e.enter().append("path").attr("class","templink").attr("d",d3.svg.diagonal()).attr("pointer-events","none"),e.attr("d",d3.svg.diagonal()),e.exit().remove()},S=Y.append("g");f=e,f.x0=w/2,f.y0=0,h(f),d(f)});
//# sourceMappingURL=dnd-tree-layout.min.js.map
