{"version":3,"sources":["assets/js/d3-to-svg.js"],"names":["d3toSvg","this","$myGraph","d3","select","init","prototype","$svg","append","bindEvents","fetchCSVData","_this","selectAll","on","onClickButtion","target","csvFile","getAttribute","initStyle","i","len","attr","setStyleAll","setStyle","$svgElement","transition","duration","d","fileName","csv","row","data1","data2","data3","get","error","data","dataSet","length","push","console","log","showGraph","fetchJsonData","json","sales","fetchHtmlData","html","docFragment","tr","querySelectorAll","td","firstChild","nodeValue","fetchXmlData","xml","xmlRoot","xmlData","salesRoot","salesData","fetchTextData","text","plainText","split","barElements","exit","remove","enter","call","elements","each","window","addEventListener"],"mappings":"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","file":"d3-to-svg.min.js","sourcesContent":["var d3toSvg = function() {\n  this.$myGraph = d3.select('#myGraph');\n  this.init();\n};\nd3toSvg.prototype = {\n  init: function() {\n    this.$svg = this.$myGraph.append('svg')\n    this.bindEvents();\n    this.fetchCSVData();\n    // this.fetchJsonData();\n    // this.fetchHtmlData();\n    // this.fetchXmlData();\n    // this.fetchTextData();\n  },\n  bindEvents: function() {\n    var _this = this;\n    d3.selectAll('button').on('click', function() {\n      _this.onClickButtion(this);\n    });\n  },\n  onClickButtion: function(target) {\n    var csvFile = target.getAttribute('data-src');\n    this.fetchCSVData( csvFile );\n  },\n  initStyle: function() {\n    for( var i = 0, len = 5; i < len; i++ ) {\n      this.$svg.append('rect')\n        .attr('x', '50px')\n        .attr('y', i * 25 + 'px')\n        .attr('width', '200px')\n        .attr('height', '20px');\n    }\n    this.setStyleAll();\n  },\n  setStyle: function($svgElement) {\n    $svgElement.attr('x', '10px')\n      //属性を指定する\n      .attr('y', '50px')\n      .attr('width', '200px')\n      .attr('height', '30px')\n      //アニメーションをつける\n      .transition()\n      .duration(3000)\n      .attr('width', '50px')\n      //スタイルを指定する\n      // .style('fill', 'red')\n      // .style('stroke', 'black');\n      // classを付与する\n      .attr('class', 'bar_note');\n  },\n  setStyleAll: function() {\n    d3.selectAll('rect')\n      .transition()\n      // 条件によりclassを付与する\n      .attr('class', function(d, i) {\n        if( i === 2 ) {\n          return 'bar_note';\n        }\n      });\n  },\n  fetchCSVData: function( fileName ) {\n    var _this = this;\n    d3.csv('/data/' + (fileName || 'mydata.csv') )\n      // CSVから取得したデータの列名を変更する\n      .row(function(d) {\n        return {\n          data1: d['item1'],\n          data2: d['item2'],\n          data3: d['item3']\n        }\n      })\n      .get(function(error, data) {\n        var dataSet = [];\n\n        for( var i = 0, len = data.length; i < len; i++ ) {\n          dataSet.push( data[i].data1 );\n        }\n        console.log( dataSet );\n        _this.showGraph( dataSet );\n      });\n  },\n  fetchJsonData: function() {\n    var _this = this;\n    d3.json('/data/mydata.json', function(error, data) {\n      if(error) {\n        console.error(error);\n        return;\n      }\n      console.log(data);\n      var dataSet = [];\n      for( var i = 0, len = data.length; i < len; i++ ) {\n        dataSet.push( data[i].sales[0] )\n      }\n      _this.showGraph( dataSet );\n    });\n  },\n  fetchHtmlData: function() {\n    var _this = this;\n    d3.html('/data/mydata.html', function(error, docFragment) {\n      if( error ) {\n        console.error( error );\n        return;\n      }\n      var tr = docFragment.querySelectorAll('table tr');\n      var dataSet = [];\n\n      for( var i = 0, len = tr.length; i < len; i++ ) {\n        var td = tr[i].querySelectorAll('td'); \n        if( !td || td.length === 0 ) {\n          continue;\n        }\n        var d = td[0].firstChild.nodeValue;\n        dataSet.push(d);\n      }\n      _this.showGraph( dataSet );\n    });\n  },\n  fetchXmlData: function() {\n    _this = this;\n    d3.xml('/data/mydata.xml', function(error, xmlRoot) {\n      if(error) {\n        console.error(error);\n        return;\n      }\n      var xmlData = xmlRoot.querySelectorAll('data');\n      var salesRoot = xmlData[0];\n      var salesData = salesRoot.querySelectorAll('sales');\n      var dataSet = [];\n\n      for( var i = 0, len = salesData.length; i < len; i++ ) {\n        var d = salesData[i].firstChild.nodeValue;\n        dataSet.push(d);\n      }\n      _this.showGraph( dataSet );\n    });\n  },\n  fetchTextData: function() {\n    var _this = this;\n    d3.text('/data/mydata.txt', function(error, plainText) {\n      if( error ) {\n        console.error(error);\n        return;\n      }\n      var data = plainText.split('\\x0a')\n      var dataSet = [];\n      var sales = data[0].split('/');\n\n      for( var i = 1, len = sales.length; i < len; i++ ) {\n        dataSet.push( sales[i] );\n      }\n      _this.showGraph( dataSet );\n    });\n  },\n  showGraph: function( dataSet ) {\n    var barElements = this.$svg\n      .selectAll('rect')\n      .data(dataSet);\n\n    //データの削除が行われる場合\n    barElements\n      .exit()\n      .remove();\n\n    barElements\n      .enter()\n      .append('rect')\n      //直接DOMの__data__プロパティを設定する\n      // .datum(function(d, i) {\n      //   return i * 10;\n      // })\n      .attr('class', 'bar')\n      .attr('height', 20)\n      .attr('x', 9)\n      .attr('y', function(d,i) {\n        return i * 25;\n      })\n      //データごとに個別の処理を実行する場合はcall, each関数を使用する\n      .call(function(elements) {\n        elements.each(function(d, i) {\n          console.log(i + ' = ' + d);\n        });\n      });\n\n    //データを更新する場合は表示更新処理を切り分ける\n    barElements.attr('width', function(d, i) {\n      return d;\n    })\n  }\n};\n\nwindow.addEventListener('load', function() {\n  new d3toSvg();\n});"],"sourceRoot":"SORUCE_DIR"}